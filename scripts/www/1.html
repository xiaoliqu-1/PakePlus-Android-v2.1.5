<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒäººå°çƒæ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            padding: 25px;
            max-width: 900px;
            width: 100%;
        }

        .game-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .game-header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            gap: 15px;
        }

        .player-info {
            flex: 1;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .player1 {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
        }

        .player2 {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
        }

        .active-player {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .player-info h3 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .player-info p {
            font-size: 1.1em;
        }

        .game-area {
            position: relative;
            margin-bottom: 25px;
        }

        .pool-table {
            width: 100%;
            height: 500px;
            background: #2d5a27;
            border: 20px solid #8B4513;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }

        .pocket {
            position: absolute;
            width: 30px;
            height: 30px;
            background: black;
            border-radius: 50%;
            z-index: 10;
        }

        .pocket.tl { top: -15px; left: -15px; }
        .pocket.tr { top: -15px; right: -15px; }
        .pocket.bl { bottom: -15px; left: -15px; }
        .pocket.br { bottom: -15px; right: -15px; }
        .pocket.ml { top: 50%; left: -15px; transform: translateY(-50%); }
        .pocket.mr { top: 50%; right: -15px; transform: translateY(-50%); }

        .ball {
            position: absolute;
            border-radius: 50%;
            z-index: 5;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
        }

        .cue-ball {
            background: radial-gradient(circle at 30% 30%, #ffffff, #f0f0f0);
            border: 2px solid #ddd;
        }

        .solid-ball {
            background: radial-gradient(circle at 30% 30%, #ff6b6b, #ee5a52);
            border: 2px solid white;
        }

        .stripe-ball {
            background: linear-gradient(45deg, #4ecdc4 50%, white 50%);
            border: 2px solid white;
        }

        .cue-stick {
            position: absolute;
            background: #8B4513;
            transform-origin: right center;
            z-index: 4;
            display: none;
        }

        .power-bar {
            width: 100%;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
        }

        .power-level {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71, #f39c12, #e74c3c);
            width: 0%;
            transition: width 0.1s ease;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #e74c3c;
            color: white;
        }

        .btn-secondary:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .game-status {
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            color: #2c3e50;
        }

        .instructions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .instructions h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .instructions ul {
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 8px;
            color: #7f8c8d;
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
            }
            
            .game-header h1 {
                font-size: 2em;
            }
            
            .pool-table {
                height: 400px;
            }
            
            .game-info {
                flex-direction: column;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>ğŸ± åŒäººå°çƒæ¸¸æˆ</h1>
            <p>äº«å—ç»å…¸çš„å°çƒå¯¹æˆ˜ä¹è¶£</p>
        </div>

        <div class="game-info">
            <div class="player-info player1 active-player" id="player1Info">
                <h3>ğŸ® ç©å®¶ä¸€</h3>
                <p>å‡»çƒæ¬¡æ•°: <span id="player1Shots">0</span></p>
                <p>è¿›çƒæ•°: <span id="player1Score">0</span></p>
            </div>
            <div class="player-info player2" id="player2Info">
                <h3>ğŸ® ç©å®¶äºŒ</h3>
                <p>å‡»çƒæ¬¡æ•°: <span id="player2Shots">0</span></p>
                <p>è¿›çƒæ•°: <span id="player2Score">0</span></p>
            </div>
        </div>

        <div class="game-status" id="gameStatus">
            ç©å®¶ä¸€çš„å›åˆ - ç‚¹å‡»çƒæ†æ–¹å‘ï¼Œæ‹–æ‹½è°ƒæ•´åŠ›åº¦
        </div>

        <div class="power-bar">
            <div class="power-level" id="powerLevel"></div>
        </div>

        <div class="game-area">
            <div class="pool-table" id="poolTable">
                <!-- è¢‹å£ -->
                <div class="pocket tl"></div>
                <div class="pocket tr"></div>
                <div class="pocket bl"></div>
                <div class="pocket br"></div>
                <div class="pocket ml"></div>
                <div class="pocket mr"></div>
                
                <!-- çƒ -->
                <!-- çƒå°†åœ¨JavaScriptä¸­åŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="cue-stick" id="cueStick"></div>
        </div>

        <div class="controls">
            <button class="btn btn-primary" id="newGameBtn">ğŸ”„ æ–°æ¸¸æˆ</button>
            <button class="btn btn-secondary" id="resetCueBtn">ğŸ¯ é‡ç½®çƒæ†</button>
        </div>

        <div class="instructions">
            <h3>ğŸ“ æ¸¸æˆè§„åˆ™ï¼š</h3>
            <ul>
                <li>ç©å®¶è½®æµå‡»çƒï¼Œä½¿ç”¨é¼ æ ‡æ§åˆ¶çƒæ†æ–¹å‘å’ŒåŠ›åº¦</li>
                <li>ç‚¹å‡»å¹¶æ‹–æ‹½é¼ æ ‡è°ƒæ•´å‡»çƒåŠ›åº¦</li>
                <li>å°†ç›®æ ‡çƒå‡»å…¥è¢‹å£å¾—åˆ†</li>
                <li>ä¸èƒ½å‡»ä¸­å¯¹æ–¹çš„çƒï¼Œå¦åˆ™å¯¹æ–¹å¾—åˆ†</li>
                <li>çŠ¯è§„åå¯¹æ–¹è·å¾—å‡»çƒæƒ</li>
                <li>æ¸¸æˆè¿›è¡Œå¤šè½®ï¼Œæœ€ç»ˆå¾—åˆ†é«˜è€…è·èƒœ</li>
            </ul>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const poolTable = document.getElementById('poolTable');
            const cueStick = document.getElementById('cueStick');
            const powerLevel = document.getElementById('powerLevel');
            const gameStatus = document.getElementById('gameStatus');
            const player1Info = document.getElementById('player1Info');
            const player2Info = document.getElementById('player2Info');
            const newGameBtn = document.getElementById('newGameBtn');
            const resetCueBtn = document.getElementById('resetCueBtn');
            
            // ç©å®¶æ•°æ®
            let players = {
                1: { shots: 0, score: 0 },
                2: { shots: 0, score: 0 }
            };
            
            let currentPlayer = 1;
            let balls = [];
            let isAiming = false;
            let isCharging = false;
            let chargeStartTime = 0;
            let cueBall = null;
            let mouseX = 0, mouseY = 0;
            let ballSpeeds = {};
            let animationId = null;
            let gameActive = true;
            
            // çƒçš„å‚æ•°
            const BALL_RADIUS = 15;
            const FRICTION = 0.98;
            const ELASTICITY = 0.8;
            
            // åˆå§‹åŒ–æ¸¸æˆ
            function initGame() {
                // é‡ç½®ç©å®¶æ•°æ®
                players[1] = { shots: 0, score: 0 };
                players[2] = { shots: 0, score: 0 };
                currentPlayer = 1;
                
                // æ¸…ç©ºçƒæ¡Œ
                const existingBalls = poolTable.querySelectorAll('.ball');
                existingBalls.forEach(ball => ball.remove());
                
                // åˆ›å»ºçƒ
                createBalls();
                
                // æ›´æ–°UI
                updatePlayerInfo();
                updateGameStatus();
                gameActive = true;
                
                // å¼€å§‹åŠ¨ç”»å¾ªç¯
                if (animationId) cancelAnimationFrame(animationId);
                animationLoop();
            }
            
            // åˆ›å»ºçƒ
            function createBalls() {
                balls = [];
                
                // æ¯çƒ (ç™½çƒ)
                cueBall = createBall(200, 250, 'cue-ball', 'white');
                balls.push(cueBall);
                
                // ç›®æ ‡çƒ
                const colors = ['solid-ball', 'stripe-ball', 'solid-ball', 'stripe-ball', 'solid-ball'];
                const positions = [
                    {x: 600, y: 250}, // 8å·çƒåœ¨ä¸­é—´
                    {x: 620, y: 240}, {x: 620, y: 260}, // ç¬¬äºŒæ’
                    {x: 640, y: 230}, {x: 640, y: 250}, {x: 640, y: 270}, // ç¬¬ä¸‰æ’
                    {x: 660, y: 220}, {x: 660, y: 240}, {x: 660, y: 260}, {x: 660, y: 280} // ç¬¬å››æ’
                ];
                
                for (let i = 0; i < positions.length; i++) {
                    const ball = createBall(
                        positions[i].x, 
                        positions[i].y, 
                        colors[i % colors.length],
                        `ball-${i+1}`
                    );
                    balls.push(ball);
                }
            }
            
            // åˆ›å»ºå•ä¸ªçƒ
            function createBall(x, y, className, id) {
                const ball = document.createElement('div');
                ball.className = `ball ${className}`;
                ball.id = id;
                ball.style.width = BALL_RADIUS * 2 + 'px';
                ball.style.height = BALL_RADIUS * 2 + 'px';
                ball.style.left = x - BALL_RADIUS + 'px';
                ball.style.top = y - BALL_RADIUS + 'px';
                
                poolTable.appendChild(ball);
                
                return {
                    element: ball,
                    x: x,
                    y: y,
                    vx: 0, // æ°´å¹³é€Ÿåº¦
                    vy: 0, // å‚ç›´é€Ÿåº¦
                    radius: BALL_RADIUS,
                    moving: false
                };
            }
            
            // æ›´æ–°ç©å®¶ä¿¡æ¯æ˜¾ç¤º
            function updatePlayerInfo() {
                document.getElementById('player1Shots').textContent = players[1].shots;
                document.getElementById('player1Score').textContent = players[1].score;
                document.getElementById('player2Shots').textContent = players[2].shots;
                document.getElementById('player2Score').textContent = players[2].score;
                
                // æ›´æ–°æ´»è·ƒç©å®¶æ˜¾ç¤º
                player1Info.classList.toggle('active-player', currentPlayer === 1);
                player2Info.classList.toggle('active-player', currentPlayer === 2);
            }
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€
            function updateGameStatus() {
                gameStatus.textContent = `ç©å®¶${currentPlayer}çš„å›åˆ - ${isAiming ? 'è°ƒæ•´åŠ›åº¦...' : 'ç‚¹å‡»çƒæ†æ–¹å‘'}`;
            }
            
            // åŠ¨ç”»å¾ªç¯
            function animationLoop() {
                if (!gameActive) return;
                
                updateBalls();
                checkCollisions();
                checkPockets();
                
                animationId = requestAnimationFrame(animationLoop);
            }
            
            // æ›´æ–°çƒçš„ä½ç½®
            function updateBalls() {
                for (const ball of balls) {
                    if (Math.abs(ball.vx) < 0.1) ball.vx = 0;
                    if (Math.abs(ball.vy) < 0.1) ball.vy = 0;
                    
                    if (ball.vx !== 0 || ball.vy !== 0) {
                        ball.x += ball.vx;
                        ball.y += ball.vy;
                        
                        // åº”ç”¨æ‘©æ“¦åŠ›
                        ball.vx *= FRICTION;
                        ball.vy *= FRICTION;
                        
                        // è¾¹ç•Œç¢°æ’
                        if (ball.x - ball.radius <= 0) {
                            ball.x = ball.radius;
                            ball.vx = -ball.vx * ELASTICITY;
                        } else if (ball.x + ball.radius >= poolTable.offsetWidth) {
                            ball.x = poolTable.offsetWidth - ball.radius;
                            ball.vx = -ball.vx * ELASTICITY;
                        }
                        
                        if (ball.y - ball.radius <= 0) {
                            ball.y = ball.radius;
                            ball.vy = -ball.vy * ELASTICITY;
                        } else if (ball.y + ball.radius >= poolTable.offsetHeight) {
                            ball.y = poolTable.offsetHeight - ball.radius;
                            ball.vy = -ball.vy * ELASTICITY;
                        }
                        
                        // æ›´æ–°DOMä½ç½®
                        ball.element.style.left = ball.x - ball.radius + 'px';
                        ball.element.style.top = ball.y - ball.radius + 'px';
                        
                        // å¦‚æœçƒåœæ­¢ç§»åŠ¨
                        if (ball.vx === 0 && ball.vy === 0) {
                            ball.moving = false;
                        }
                    }
                }
                
                // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰çƒéƒ½åœæ­¢
                const allStopped = balls.every(ball => !ball.moving);
                if (allStopped && (Math.abs(cueBall.vx) < 0.1 && Math.abs(cueBall.vy) < 0.1)) {
                    isAiming = false;
                    updateGameStatus();
                }
            }
            
            // æ£€æŸ¥çƒçš„ç¢°æ’
            function checkCollisions() {
                for (let i = 0; i < balls.length; i++) {
                    for (let j = i + 1; j < balls.length; j++) {
                        const ball1 = balls[i];
                        const ball2 = balls[j];
                        
                        const dx = ball2.x - ball1.x;
                        const dy = ball2.y - ball1.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        // æ£€æŸ¥æ˜¯å¦ç¢°æ’
                        if (distance < ball1.radius + ball2.radius) {
                            // è®¡ç®—ç¢°æ’åçš„é€Ÿåº¦
                            const angle = Math.atan2(dy, dx);
                            const sin = Math.sin(angle);
                            const cos = Math.cos(angle);
                            
                            // æ—‹è½¬é€Ÿåº¦å‘é‡
                            const vx1 = ball1.vx * cos + ball1.vy * sin;
                            const vy1 = ball1.vy * cos - ball1.vx * sin;
                            const vx2 = ball2.vx * cos + ball2.vy * sin;
                            const vy2 = ball2.vy * cos - ball2.vx * sin;
                            
                            // ä¸€ç»´å¼¹æ€§ç¢°æ’
                            const finalVx1 = ((ball1.radius - ball2.radius) * vx1 + 2 * ball2.radius * vx2) / (ball1.radius + ball2.radius);
                            const finalVx2 = ((ball2.radius - ball1.radius) * vx2 + 2 * ball1.radius * vx1) / (ball1.radius + ball2.radius);
                            
                            // æ—‹è½¬å›åŸåæ ‡ç³»
                            ball1.vx = finalVx1 * cos - vy1 * sin;
                            ball1.vy = vy1 * cos + finalVx1 * sin;
                            ball2.vx = finalVx2 * cos - vy2 * sin;
                            ball2.vy = vy2 * cos + finalVx2 * sin;
                            
                            // åˆ†ç¦»çƒä»¥é¿å…é‡å 
                            const overlap = ball1.radius + ball2.radius - distance;
                            const moveX = (overlap / 2) * (dx / distance);
                            const moveY = (overlap / 2) * (dy / distance);
                            
                            ball1.x -= moveX;
                            ball1.y -= moveY;
                            ball2.x += moveX;
                            ball2.y += moveY;
                        }
                    }
                }
            }
            
            // æ£€æŸ¥è½è¢‹
            function checkPockets() {
                for (let i = balls.length - 1; i >= 0; i--) {
                    const ball = balls[i];
                    
                    // æ£€æŸ¥æ˜¯å¦è½å…¥è¢‹å£
                    const pockets = [
                        {x: 0, y: 0}, // å·¦ä¸Š
                        {x: poolTable.offsetWidth, y: 0}, // å³ä¸Š
                        {x: 0, y: poolTable.offsetHeight}, // å·¦ä¸‹
                        {x: poolTable.offsetWidth, y: poolTable.offsetHeight}, // å³ä¸‹
                        {x: 0, y: poolTable.offsetHeight / 2}, // å·¦ä¸­
                        {x: poolTable.offsetWidth, y: poolTable.offsetHeight / 2} // å³ä¸­
                    ];
                    
                    for (const pocket of pockets) {
                        const dx = ball.x - pocket.x;
                        const dy = ball.y - pocket.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < 25) { // è¢‹å£åŠå¾„
                            // å¦‚æœæ˜¯æ¯çƒï¼Œé‡ç½®ä½ç½®
                            if (ball === cueBall) {
                                ball.x = 200;
                                ball.y = 250;
                                ball.vx = 0;
                                ball.vy = 0;
                                ball.element.style.left = ball.x - ball.radius + 'px';
                                ball.element.style.top = ball.y - ball.radius + 'px';
                                // ç»™å¯¹æ–¹åŠ ä¸€åˆ†ï¼ˆçŠ¯è§„ï¼‰
                                const otherPlayer = currentPlayer === 1 ? 2 : 1;
                                players[otherPlayer].score += 1;
                                updatePlayerInfo();
                                switchPlayer();
                            } else {
                                // å…¶ä»–çƒç§»é™¤
                                ball.element.remove();
                                balls.splice(i, 1);
                                
                                // ç»™å½“å‰ç©å®¶åŠ åˆ†
                                players[currentPlayer].score += 1;
                                updatePlayerInfo();
                            }
                            break;
                        }
                    }
                }
            }
            
            // åˆ‡æ¢ç©å®¶
            function switchPlayer() {
                currentPlayer = currentPlayer === 1 ? 2 : 1;
                players[currentPlayer].shots += 1;
                updatePlayerInfo();
                updateGameStatus();
            }
            
            // äº‹ä»¶ç›‘å¬å™¨
            poolTable.addEventListener('mousemove', function(e) {
                if (!isAiming || !gameActive) return;
                
                const rect = poolTable.getBoundingClientRect();
                mouseX = e.clientX - rect.left;
                mouseY = e.clientY - rect.top;
                
                // æ›´æ–°çƒæ†ä½ç½®å’Œè§’åº¦
                const angle = Math.atan2(mouseY - cueBall.y, mouseX - cueBall.x);
                const distance = Math.sqrt(Math.pow(mouseX - cueBall.x, 2) + Math.pow(mouseY - cueBall.y, 2));
                
                cueStick.style.display = 'block';
                cueStick.style.width = (distance - 30) + 'px';
                cueStick.style.height = '4px';
                cueStick.style.left = (cueBall.x + 15 * Math.cos(angle)) + 'px';
                cueStick.style.top = (cueBall.y + 15 * Math.sin(angle)) + 'px';
                cueStick.style.transform = `rotate(${angle}rad)`;
                
                // æ›´æ–°åŠ›åº¦æ¡
                const timeDiff = (Date.now() - chargeStartTime) / 100; // æ¨¡æ‹Ÿå……ç”µ
                const power = Math.min(timeDiff, 100);
                powerLevel.style.width = power + '%';
            });
            
            poolTable.addEventListener('mousedown', function(e) {
                if (!gameActive) return;
                
                const rect = poolTable.getBoundingClientRect();
                mouseX = e.clientX - rect.left;
                mouseY = e.clientY - rect.top;
                
                // æ£€æŸ¥æ˜¯å¦ç‚¹å‡»åœ¨æ¯çƒé™„è¿‘
                const dx = mouseX - cueBall.x;
                const dy = mouseY - cueBall.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance <= BALL_RADIUS * 2 && !isAiming) {
                    isAiming = true;
                    chargeStartTime = Date.now();
                    updateGameStatus();
                }
            });
            
            poolTable.addEventListener('mouseup', function(e) {
                if (!isAiming || !gameActive) return;
                
                // è®¡ç®—å‡»çƒåŠ›åº¦
                const power = Math.min((Date.now() - chargeStartTime) / 20, 100);
                
                // è®¡ç®—æ–¹å‘å’Œé€Ÿåº¦
                const dx = mouseX - cueBall.x;
                const dy = mouseY - cueBall.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance > 0) {
                    cueBall.vx = (dx / distance) * (power / 10);
                    cueBall.vy = (dy / distance) * (power / 10);
                    cueBall.moving = true;
                    
                    // å¢åŠ ç©å®¶å‡»çƒæ¬¡æ•°
                    players[currentPlayer].shots += 1;
                    updatePlayerInfo();
                }
                
                // é‡ç½®çŠ¶æ€
                isAiming = false;
                cueStick.style.display = 'none';
                powerLevel.style.width = '0%';
                
                // åˆ‡æ¢ç©å®¶ï¼ˆåœ¨çƒåœæ­¢åï¼‰
                setTimeout(() => {
                    // å®é™…æ¸¸æˆä¸­ï¼Œåº”è¯¥åœ¨æ‰€æœ‰çƒéƒ½åœæ­¢åå†åˆ‡æ¢
                }, 1000);
            });
            
            newGameBtn.addEventListener('click', initGame);
            resetCueBtn.addEventListener('click', function() {
                cueStick.style.display = 'none';
                powerLevel.style.width = '0%';
                isAiming = false;
                updateGameStatus();
            });
            
            // åˆå§‹åŒ–æ¸¸æˆ
            initGame();
        });
    </script>
</body>
</html>